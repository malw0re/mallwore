<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>stealth | OUHBOY</title>
<meta name="keywords" content="tryhackme">
<meta name="description" content="Stealth Tryhackme Room">
<meta name="author" content="Malw0re">
<link rel="canonical" href="https://malw0re.github.io/posts/tryhackme/stealth/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css" integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U&#43;6hYRq/Ez/nm5vg=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://malw0re.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://malw0re.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://malw0re.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://malw0re.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://malw0re.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="stealth" />
<meta property="og:description" content="Stealth Tryhackme Room" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://malw0re.github.io/posts/tryhackme/stealth/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-29T11:30:03+00:00" />
<meta property="article:modified_time" content="2023-11-29T11:30:03+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="stealth"/>
<meta name="twitter:description" content="Stealth Tryhackme Room"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://malw0re.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "stealth",
      "item": "https://malw0re.github.io/posts/tryhackme/stealth/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "stealth",
  "name": "stealth",
  "description": "Stealth Tryhackme Room",
  "keywords": [
    "tryhackme"
  ],
  "articleBody": " nmap scans PORT STATE SERVICE REASON VERSION 139/tcp open netbios-ssn syn-ack Microsoft Windows netbios-ssn 445/tcp open microsoft-ds? syn-ack 3389/tcp open ms-wbt-server syn-ack Microsoft Terminal Services |_ssl-date: 2023-11-30T18:28:49+00:00; -1s from scanner time. | rdp-ntlm-info: | Target_Name: HOSTEVASION | NetBIOS_Domain_Name: HOSTEVASION | NetBIOS_Computer_Name: HOSTEVASION | DNS_Domain_Name: HostEvasion | DNS_Computer_Name: HostEvasion | Product_Version: 10.0.17763 |_ System_Time: 2023-11-30T18:28:10+00:00 | ssl-cert: Subject: commonName=HostEvasion | Issuer: commonName=HostEvasion | Public Key type: rsa | Public Key bits: 2048 | Signature Algorithm: sha256WithRSAEncryption | Not valid before: 2023-07-28T19:06:15 | Not valid after: 2024-01-27T19:06:15 | MD5: 110c:1c21:e230:b7c7:41f5:4b6a:bf2b:9e6a | SHA-1: 34ad:3702:1a0a:2054:88a9:ea0c:820b:da64:b1bd:fb56 | -----BEGIN CERTIFICATE----- | MIIC2jCCAcKgAwIBAgIQMIOcafxeh79B5cu+rs/taDANBgkqhkiG9w0BAQsFADAW | MRQwEgYDVQQDEwtIb3N0RXZhc2lvbjAeFw0yMzA3MjgxOTA2MTVaFw0yNDAxMjcx | OTA2MTVaMBYxFDASBgNVBAMTC0hvc3RFdmFzaW9uMIIBIjANBgkqhkiG9w0BAQEF | AAOCAQ8AMIIBCgKCAQEA2tUyXSZT7x2YueFMia0tU6xweBIvbwEXw0MBCXtHEf9A | LqZ6aiwNSsiLeW/kfBsqw6LArZNajuGggR2uj2HLGMn9Yx2RjnMSUaVWlJnB+j7s | YsgeVOr3Y8rFv0EPD2M6tKEZ7Zh8HoaBifHR3qeNIx+n6YcYmSjb0mUQ5kQso7SS | L7a9Beya4aynWgHXegaCVP0CcA750BRf1Ax+tjpojoTJOarC0C1QibbDs0s6NbUY | Z1CakxCRQlENDRau+vqqhRMxlbEfayl1YICTfMe6j3hMnVeYiPjZECt2nSe92i2p | rnzpdZ4Xbe8tdDzGETQGkBdOCOKPk6/nh80ifpcjBQIDAQABoyQwIjATBgNVHSUE | DDAKBggrBgEFBQcDATALBgNVHQ8EBAMCBDAwDQYJKoZIhvcNAQELBQADggEBABB4 | HKrRnIrik9ef1F3Ah6r4FsdpCmZ0vXLNixsqm8IY81fNcRTogc/WFytU9gylcxRk | LhoUqXwtQhKqMFOKcEh3Kq2+VMUvgxTxvDywFS4S02AlhWtafq8NBm5nfxxubuit | tRO3fvdQ7mKS2hWvapW9+guEt0zJZI3Ai/C4NIq5WpbLEGSJe6DHUwXaPyFiHNYy | 5j91hKUWbDnIy4TqiIPjhBjYhrTvi46fbGbqMpHelUGABzJ5LFfGjORMOWA1bRPz | wuaEP62Dimr42pzbLPIgGTmBwpIXlpKdcydbJnVORxY4AfpLV6ypt2EPYS2TpKbz | 4Fw5A8aWrShuerOI7mc= |_-----END CERTIFICATE----- 5985/tcp open http syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 8000/tcp open http syn-ack PHP cli server 5.5 or later |_http-title: 404 Not Found | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS 8080/tcp open http syn-ack Apache httpd 2.4.56 ((Win64) OpenSSL/1.1.1t PHP/8.0.28) | http-open-proxy: Potentially OPEN proxy. |_Methods supported:CONNECTION |_http-server-header: Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.0.28 |_http-title: PowerShell Script Analyser | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS 8443/tcp open ssl/http syn-ack Apache httpd 2.4.56 ((Win64) OpenSSL/1.1.1t PHP/8.0.28) |_http-server-header: Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.0.28 |_ssl-date: TLS randomness does not represent time | ssl-cert: Subject: commonName=localhost | Issuer: commonName=localhost | Public Key type: rsa | Public Key bits: 1024 | Signature Algorithm: sha1WithRSAEncryption | Not valid before: 2009-11-10T23:48:47 | Not valid after: 2019-11-08T23:48:47 | MD5: a0a4:4cc9:9e84:b26f:9e63:9f9e:d229:dee0 | SHA-1: b023:8c54:7a90:5bfa:119c:4e8b:acca:eacf:3649:1ff6 | -----BEGIN CERTIFICATE----- | MIIBnzCCAQgCCQC1x1LJh4G1AzANBgkqhkiG9w0BAQUFADAUMRIwEAYDVQQDEwls | b2NhbGhvc3QwHhcNMDkxMTEwMjM0ODQ3WhcNMTkxMTA4MjM0ODQ3WjAUMRIwEAYD | VQQDEwlsb2NhbGhvc3QwgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAMEl0yfj | 7K0Ng2pt51+adRAj4pCdoGOVjx1BmljVnGOMW3OGkHnMw9ajibh1vB6UfHxu463o | J1wLxgxq+Q8y/rPEehAjBCspKNSq+bMvZhD4p8HNYMRrKFfjZzv3ns1IItw46kgT | gDpAl1cMRzVGPXFimu5TnWMOZ3ooyaQ0/xntAgMBAAEwDQYJKoZIhvcNAQEFBQAD | gYEAavHzSWz5umhfb/MnBMa5DL2VNzS+9whmmpsDGEG+uR0kM1W2GQIdVHHJTyFd | aHXzgVJBQcWTwhp84nvHSiQTDBSaT6cQNQpvag/TaED/SEQpm0VqDFwpfFYuufBL | vVNbLkKxbK2XwUvu0RxoLdBMC/89HqrZ0ppiONuQ+X2MtxE= |_-----END CERTIFICATE----- |_http-title: PowerShell Script Analyser | tls-alpn: |_ http/1.1 | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS 47001/tcp open http syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Not Found |_http-server-header: Microsoft-HTTPAPI/2.0 49664/tcp open msrpc syn-ack Microsoft Windows RPC 49665/tcp open msrpc syn-ack Microsoft Windows RPC 49666/tcp open msrpc syn-ack Microsoft Windows RPC 49667/tcp open msrpc syn-ack Microsoft Windows RPC 49668/tcp open msrpc syn-ack Microsoft Windows RPC 49669/tcp open msrpc syn-ack Microsoft Windows RPC 49670/tcp open msrpc syn-ack Microsoft Windows RPC Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: 0s, deviation: 0s, median: -1s | smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required | p2p-conficker: | Checking for Conficker.C or higher... | Check 1 (port 52662/tcp): CLEAN (Timeout) | Check 2 (port 33712/tcp): CLEAN (Timeout) | Check 3 (port 30307/udp): CLEAN (Timeout) | Check 4 (port 41933/udp): CLEAN (Timeout) |_ 0/4 checks are positive: Host is CLEAN or ports are blocked | smb2-time: | date: 2023-11-30T18:28:10 |_ start_date: N/A checking the site Checking the site out as described on tryhackme we are presented a site.\nSo on the site we are only allowed to upload powershell scripts, we need to upload a script which will give us a reverse sehll to connect to the machine.\ninitial foothold Generating a reverse shell with revshells and uploading it on the website we get a connection back.\nDisclaimer After uploading the script and using netcat as your listener you‚Äôll get a shell connection back but without the terminal instant which is ‚Äòfunny‚Äô to work with.\nA better shell instance that i got was from this guy malw0re. So after uploading we get a clean looking shell back. Searching the folders we land on the Desktop folder and there is a file called encodedflag.\nDecoding and reading the file we get some interesting message.\nFollowing the decoded message and checking it out on the webpage we get an interesting message. user level flag. Checking the documents file there is a directory called tasks inside it there‚Äôs a file called log.txt and from the webpage response we need to remove the log file not to alert the blue team, removing the log file and reloading the webpage we get nothing so got stuck for a while. Then reading the file.ps1 we see there is a directory hosting xampp\nUnder the uploads directory, we identify the a log file removing it and refreshing the page we get the first flag.\nroot level flag. Having the user flag we need to look out for privesc vectors on the box and since it‚Äôs a windows box i uploaded a powershell script that looks for some vectors.\nThe command is downloading the (win-priv-check.ps1) from my attacker ip address using using the Invoke-WebRequest cmdlet and saving it locally as win.ps1. Running the script it identifies apache is running as admin.\nLet‚Äôs check evader‚Äôs privileges and check if we can abuse any privileges.\nso we don‚Äôt have any specific privilege that we can abuse so my next step was to upload a malicious php script to the webserver using pownyshell.\nchecking the privileges we see it‚Äôs different from the output we go previously.\nAs we can see we can abuse the ‚ÄúSetImpersonatePrivilege‚Äù any process holding this privilege can impersonate (but not create) any token for which it is able to gethandle. You can get a privileged token from a Windows service (DCOM) making it perform an NTLM authentication against the exploit, then execute a process as SYSTEM referenced from here.\nSo our privesc vector are all relate to a potato exploit and after trying and failing i landed on the ‚Äúefspotato‚Äù exploit which worked and elevate our privileges to NT SYSTEM!!\nTrying to get the admin flag we are face with some errors.\nSo the next step was creating a user with admin privileges then rdp into the machine and get the machine.\nLogin into the machine with the created user and get the flag\nHope you learnt something new ‚ú®\n",
  "wordCount" : "946",
  "inLanguage": "en",
  "datePublished": "2023-11-29T11:30:03Z",
  "dateModified": "2023-11-29T11:30:03Z",
  "author":{
    "@type": "Person",
    "name": "Malw0re"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://malw0re.github.io/posts/tryhackme/stealth/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "OUHBOY",
    "logo": {
      "@type": "ImageObject",
      "url": "https://malw0re.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://malw0re.github.io/" accesskey="h" title="OUHBOY (Alt + H)">OUHBOY</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://malw0re.github.io/posts/" title="posts">
                    <span>posts</span>
                </a>
            </li>
            <li>
                <a href="https://malw0re.github.io/about/" title="about">
                    <span>about</span>
                </a>
            </li>
            <li>
                <a href="https://malw0re.github.io/tags/" title="tags">
                    <span>tags</span>
                </a>
            </li>
            <li>
                <a href="https://malw0re.github.io/archives/" title="archives">
                    <span>archives</span>
                </a>
            </li>
            <li>
                <a href="https://malw0re.github.io/search/" title="üîç (Alt &#43; /)" accesskey=/>
                    <span>üîç</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      stealth
    </h1>
    <div class="post-description">
      Stealth Tryhackme Room
    </div>
    <div class="post-meta">&lt;span title=&#39;2023-11-29 11:30:03 &#43;0000 &#43;0000&#39;&gt;November 29, 2023&lt;/span&gt;&amp;nbsp;¬∑&amp;nbsp;5 min&amp;nbsp;¬∑&amp;nbsp;Malw0re

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#nmap-scans" aria-label="nmap scans">nmap scans</a></li>
                <li>
                    <a href="#checking-the-site" aria-label="checking the site">checking the site</a></li>
                <li>
                    <a href="#initial-foothold" aria-label="initial foothold">initial foothold</a></li>
                <li>
                    <a href="#user-level-flag" aria-label="user level flag.">user level flag.</a></li>
                <li>
                    <a href="#root-level-flag" aria-label="root level flag.">root level flag.</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p><img loading="lazy" src="https://i.imgur.com/gd7lkVU.png" alt=""  />
</p>
<h2 id="nmap-scans">nmap scans<a hidden class="anchor" aria-hidden="true" href="#nmap-scans">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>PORT      STATE SERVICE       REASON  VERSION
</span></span><span style="display:flex;"><span>139/tcp   open  netbios-ssn   syn-ack Microsoft Windows netbios-ssn
</span></span><span style="display:flex;"><span>445/tcp   open  microsoft-ds? syn-ack
</span></span><span style="display:flex;"><span>3389/tcp  open  ms-wbt-server syn-ack Microsoft Terminal Services
</span></span><span style="display:flex;"><span>|_ssl-date: 2023-11-30T18:28:49+00:00; -1s from scanner time.
</span></span><span style="display:flex;"><span>| rdp-ntlm-info: 
</span></span><span style="display:flex;"><span>|   Target_Name: HOSTEVASION
</span></span><span style="display:flex;"><span>|   NetBIOS_Domain_Name: HOSTEVASION
</span></span><span style="display:flex;"><span>|   NetBIOS_Computer_Name: HOSTEVASION
</span></span><span style="display:flex;"><span>|   DNS_Domain_Name: HostEvasion
</span></span><span style="display:flex;"><span>|   DNS_Computer_Name: HostEvasion
</span></span><span style="display:flex;"><span>|   Product_Version: 10.0.17763
</span></span><span style="display:flex;"><span>|_  System_Time: 2023-11-30T18:28:10+00:00
</span></span><span style="display:flex;"><span>| ssl-cert: Subject: commonName<span style="color:#f92672">=</span>HostEvasion
</span></span><span style="display:flex;"><span>| Issuer: commonName<span style="color:#f92672">=</span>HostEvasion
</span></span><span style="display:flex;"><span>| Public Key type: rsa
</span></span><span style="display:flex;"><span>| Public Key bits: <span style="color:#ae81ff">2048</span>
</span></span><span style="display:flex;"><span>| Signature Algorithm: sha256WithRSAEncryption
</span></span><span style="display:flex;"><span>| Not valid before: 2023-07-28T19:06:15
</span></span><span style="display:flex;"><span>| Not valid after:  2024-01-27T19:06:15
</span></span><span style="display:flex;"><span>| MD5:   110c:1c21:e230:b7c7:41f5:4b6a:bf2b:9e6a
</span></span><span style="display:flex;"><span>| SHA-1: 34ad:3702:1a0a:2054:88a9:ea0c:820b:da64:b1bd:fb56
</span></span><span style="display:flex;"><span>| -----BEGIN CERTIFICATE-----
</span></span><span style="display:flex;"><span>| MIIC2jCCAcKgAwIBAgIQMIOcafxeh79B5cu+rs/taDANBgkqhkiG9w0BAQsFADAW
</span></span><span style="display:flex;"><span>| MRQwEgYDVQQDEwtIb3N0RXZhc2lvbjAeFw0yMzA3MjgxOTA2MTVaFw0yNDAxMjcx
</span></span><span style="display:flex;"><span>| OTA2MTVaMBYxFDASBgNVBAMTC0hvc3RFdmFzaW9uMIIBIjANBgkqhkiG9w0BAQEF
</span></span><span style="display:flex;"><span>| AAOCAQ8AMIIBCgKCAQEA2tUyXSZT7x2YueFMia0tU6xweBIvbwEXw0MBCXtHEf9A
</span></span><span style="display:flex;"><span>| LqZ6aiwNSsiLeW/kfBsqw6LArZNajuGggR2uj2HLGMn9Yx2RjnMSUaVWlJnB+j7s
</span></span><span style="display:flex;"><span>| YsgeVOr3Y8rFv0EPD2M6tKEZ7Zh8HoaBifHR3qeNIx+n6YcYmSjb0mUQ5kQso7SS
</span></span><span style="display:flex;"><span>| L7a9Beya4aynWgHXegaCVP0CcA750BRf1Ax+tjpojoTJOarC0C1QibbDs0s6NbUY
</span></span><span style="display:flex;"><span>| Z1CakxCRQlENDRau+vqqhRMxlbEfayl1YICTfMe6j3hMnVeYiPjZECt2nSe92i2p
</span></span><span style="display:flex;"><span>| rnzpdZ4Xbe8tdDzGETQGkBdOCOKPk6/nh80ifpcjBQIDAQABoyQwIjATBgNVHSUE
</span></span><span style="display:flex;"><span>| DDAKBggrBgEFBQcDATALBgNVHQ8EBAMCBDAwDQYJKoZIhvcNAQELBQADggEBABB4
</span></span><span style="display:flex;"><span>| HKrRnIrik9ef1F3Ah6r4FsdpCmZ0vXLNixsqm8IY81fNcRTogc/WFytU9gylcxRk
</span></span><span style="display:flex;"><span>| LhoUqXwtQhKqMFOKcEh3Kq2+VMUvgxTxvDywFS4S02AlhWtafq8NBm5nfxxubuit
</span></span><span style="display:flex;"><span>| tRO3fvdQ7mKS2hWvapW9+guEt0zJZI3Ai/C4NIq5WpbLEGSJe6DHUwXaPyFiHNYy
</span></span><span style="display:flex;"><span>| 5j91hKUWbDnIy4TqiIPjhBjYhrTvi46fbGbqMpHelUGABzJ5LFfGjORMOWA1bRPz
</span></span><span style="display:flex;"><span>| wuaEP62Dimr42pzbLPIgGTmBwpIXlpKdcydbJnVORxY4AfpLV6ypt2EPYS2TpKbz
</span></span><span style="display:flex;"><span>| 4Fw5A8aWrShuerOI7mc<span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>|_-----END CERTIFICATE-----
</span></span><span style="display:flex;"><span>5985/tcp  open  http          syn-ack Microsoft HTTPAPI httpd 2.0 <span style="color:#f92672">(</span>SSDP/UPnP<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_http-server-header: Microsoft-HTTPAPI/2.0
</span></span><span style="display:flex;"><span>|_http-title: Not Found
</span></span><span style="display:flex;"><span>8000/tcp  open  http          syn-ack PHP cli server 5.5 or later
</span></span><span style="display:flex;"><span>|_http-title: <span style="color:#ae81ff">404</span> Not Found
</span></span><span style="display:flex;"><span>| http-methods: 
</span></span><span style="display:flex;"><span>|_  Supported Methods: GET HEAD POST OPTIONS
</span></span><span style="display:flex;"><span>8080/tcp  open  http          syn-ack Apache httpd 2.4.56 <span style="color:#f92672">((</span>Win64<span style="color:#f92672">)</span> OpenSSL/1.1.1t PHP/8.0.28<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| http-open-proxy: Potentially OPEN proxy.
</span></span><span style="display:flex;"><span>|_Methods supported:CONNECTION
</span></span><span style="display:flex;"><span>|_http-server-header: Apache/2.4.56 <span style="color:#f92672">(</span>Win64<span style="color:#f92672">)</span> OpenSSL/1.1.1t PHP/8.0.28
</span></span><span style="display:flex;"><span>|_http-title: PowerShell Script Analyser
</span></span><span style="display:flex;"><span>| http-methods: 
</span></span><span style="display:flex;"><span>|_  Supported Methods: GET HEAD POST OPTIONS
</span></span><span style="display:flex;"><span>8443/tcp  open  ssl/http      syn-ack Apache httpd 2.4.56 <span style="color:#f92672">((</span>Win64<span style="color:#f92672">)</span> OpenSSL/1.1.1t PHP/8.0.28<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_http-server-header: Apache/2.4.56 <span style="color:#f92672">(</span>Win64<span style="color:#f92672">)</span> OpenSSL/1.1.1t PHP/8.0.28
</span></span><span style="display:flex;"><span>|_ssl-date: TLS randomness does not represent time
</span></span><span style="display:flex;"><span>| ssl-cert: Subject: commonName<span style="color:#f92672">=</span>localhost
</span></span><span style="display:flex;"><span>| Issuer: commonName<span style="color:#f92672">=</span>localhost
</span></span><span style="display:flex;"><span>| Public Key type: rsa
</span></span><span style="display:flex;"><span>| Public Key bits: <span style="color:#ae81ff">1024</span>
</span></span><span style="display:flex;"><span>| Signature Algorithm: sha1WithRSAEncryption
</span></span><span style="display:flex;"><span>| Not valid before: 2009-11-10T23:48:47
</span></span><span style="display:flex;"><span>| Not valid after:  2019-11-08T23:48:47
</span></span><span style="display:flex;"><span>| MD5:   a0a4:4cc9:9e84:b26f:9e63:9f9e:d229:dee0
</span></span><span style="display:flex;"><span>| SHA-1: b023:8c54:7a90:5bfa:119c:4e8b:acca:eacf:3649:1ff6
</span></span><span style="display:flex;"><span>| -----BEGIN CERTIFICATE-----
</span></span><span style="display:flex;"><span>| MIIBnzCCAQgCCQC1x1LJh4G1AzANBgkqhkiG9w0BAQUFADAUMRIwEAYDVQQDEwls
</span></span><span style="display:flex;"><span>| b2NhbGhvc3QwHhcNMDkxMTEwMjM0ODQ3WhcNMTkxMTA4MjM0ODQ3WjAUMRIwEAYD
</span></span><span style="display:flex;"><span>| VQQDEwlsb2NhbGhvc3QwgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAMEl0yfj
</span></span><span style="display:flex;"><span>| 7K0Ng2pt51+adRAj4pCdoGOVjx1BmljVnGOMW3OGkHnMw9ajibh1vB6UfHxu463o
</span></span><span style="display:flex;"><span>| J1wLxgxq+Q8y/rPEehAjBCspKNSq+bMvZhD4p8HNYMRrKFfjZzv3ns1IItw46kgT
</span></span><span style="display:flex;"><span>| gDpAl1cMRzVGPXFimu5TnWMOZ3ooyaQ0/xntAgMBAAEwDQYJKoZIhvcNAQEFBQAD
</span></span><span style="display:flex;"><span>| gYEAavHzSWz5umhfb/MnBMa5DL2VNzS+9whmmpsDGEG+uR0kM1W2GQIdVHHJTyFd
</span></span><span style="display:flex;"><span>| aHXzgVJBQcWTwhp84nvHSiQTDBSaT6cQNQpvag/TaED/SEQpm0VqDFwpfFYuufBL
</span></span><span style="display:flex;"><span>| vVNbLkKxbK2XwUvu0RxoLdBMC/89HqrZ0ppiONuQ+X2MtxE<span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>|_-----END CERTIFICATE-----
</span></span><span style="display:flex;"><span>|_http-title: PowerShell Script Analyser
</span></span><span style="display:flex;"><span>| tls-alpn: 
</span></span><span style="display:flex;"><span>|_  http/1.1
</span></span><span style="display:flex;"><span>| http-methods: 
</span></span><span style="display:flex;"><span>|_  Supported Methods: GET HEAD POST OPTIONS
</span></span><span style="display:flex;"><span>47001/tcp open  http          syn-ack Microsoft HTTPAPI httpd 2.0 <span style="color:#f92672">(</span>SSDP/UPnP<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_http-title: Not Found
</span></span><span style="display:flex;"><span>|_http-server-header: Microsoft-HTTPAPI/2.0
</span></span><span style="display:flex;"><span>49664/tcp open  msrpc         syn-ack Microsoft Windows RPC
</span></span><span style="display:flex;"><span>49665/tcp open  msrpc         syn-ack Microsoft Windows RPC
</span></span><span style="display:flex;"><span>49666/tcp open  msrpc         syn-ack Microsoft Windows RPC
</span></span><span style="display:flex;"><span>49667/tcp open  msrpc         syn-ack Microsoft Windows RPC
</span></span><span style="display:flex;"><span>49668/tcp open  msrpc         syn-ack Microsoft Windows RPC
</span></span><span style="display:flex;"><span>49669/tcp open  msrpc         syn-ack Microsoft Windows RPC
</span></span><span style="display:flex;"><span>49670/tcp open  msrpc         syn-ack Microsoft Windows RPC
</span></span><span style="display:flex;"><span>Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Host script results:
</span></span><span style="display:flex;"><span>|_clock-skew: mean: 0s, deviation: 0s, median: -1s
</span></span><span style="display:flex;"><span>| smb2-security-mode: 
</span></span><span style="display:flex;"><span>|   3:1:1: 
</span></span><span style="display:flex;"><span>|_    Message signing enabled but not required
</span></span><span style="display:flex;"><span>| p2p-conficker: 
</span></span><span style="display:flex;"><span>|   Checking <span style="color:#66d9ef">for</span> Conficker.C or higher...
</span></span><span style="display:flex;"><span>|   Check <span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span>port 52662/tcp<span style="color:#f92672">)</span>: CLEAN <span style="color:#f92672">(</span>Timeout<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|   Check <span style="color:#ae81ff">2</span> <span style="color:#f92672">(</span>port 33712/tcp<span style="color:#f92672">)</span>: CLEAN <span style="color:#f92672">(</span>Timeout<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|   Check <span style="color:#ae81ff">3</span> <span style="color:#f92672">(</span>port 30307/udp<span style="color:#f92672">)</span>: CLEAN <span style="color:#f92672">(</span>Timeout<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|   Check <span style="color:#ae81ff">4</span> <span style="color:#f92672">(</span>port 41933/udp<span style="color:#f92672">)</span>: CLEAN <span style="color:#f92672">(</span>Timeout<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_  0/4 checks are positive: Host is CLEAN or ports are blocked
</span></span><span style="display:flex;"><span>| smb2-time: 
</span></span><span style="display:flex;"><span>|   date: 2023-11-30T18:28:10
</span></span><span style="display:flex;"><span>|_  start_date: N/A
</span></span></code></pre></div><h2 id="checking-the-site">checking the site<a hidden class="anchor" aria-hidden="true" href="#checking-the-site">#</a></h2>
<p><img loading="lazy" src="https://i.imgur.com/uV5DpSl.png" alt=""  />
</p>
<p>Checking the site out as described on tryhackme we are presented a site.</p>
<p><img loading="lazy" src="https://i.imgur.com/JWMZg47.png" alt=""  />
</p>
<p>So on the site we are only allowed to upload powershell scripts, we need to upload a script which will give us a reverse sehll to connect to the machine.</p>
<h2 id="initial-foothold">initial foothold<a hidden class="anchor" aria-hidden="true" href="#initial-foothold">#</a></h2>
<p>Generating a reverse shell with <a href="http://revshells.com">revshells</a> and uploading it on the website we get a connection back.</p>
<p><em>Disclaimer</em>
<img loading="lazy" src="https://i.imgur.com/FQKIuhp.png" alt=""  />

After uploading the script and using netcat as your listener you&rsquo;ll get a shell connection back but without the terminal instant which is <em>&lsquo;funny&rsquo;</em> to work with.</p>
<p>A better shell instance that i got was from this guy <a href="https://github.com/malw0re/scriptures-">malw0re</a>. So after uploading we get a clean looking shell back. Searching the folders we land on the Desktop folder and there is a file called <em>encodedflag</em>.</p>
<p>Decoding and reading the file we get some interesting message.</p>
<p><img loading="lazy" src="https://i.imgur.com/kNofE1s.png" alt=""  />
</p>
<p>Following the decoded message and checking it out on the webpage we get an interesting message.
<img loading="lazy" src="https://i.imgur.com/JqHJOnC.png" alt=""  />
</p>
<h2 id="user-level-flag">user level flag.<a hidden class="anchor" aria-hidden="true" href="#user-level-flag">#</a></h2>
<p>Checking the documents file there is a directory called tasks inside it there&rsquo;s a file called log.txt and from the webpage response we need to remove the log file not to alert the blue team, removing the log file and reloading the webpage we get nothing so got stuck for a while.
Then reading the <em>file.ps1</em> we see there is a directory hosting xampp</p>
<p><img loading="lazy" src="https://i.imgur.com/ZaomI08.png" alt=""  />
</p>
<p>Under the uploads directory, we identify the a log file removing it and refreshing the page we get the first flag.</p>
<p><img loading="lazy" src="https://i.imgur.com/6C9PKha.png" alt=""  />
</p>
<p><img loading="lazy" src="https://i.imgur.com/o4vn183.png" alt=""  />
</p>
<h2 id="root-level-flag">root level flag.<a hidden class="anchor" aria-hidden="true" href="#root-level-flag">#</a></h2>
<p>Having the user flag we need to look out for privesc vectors on the box and since it&rsquo;s a windows box i uploaded a powershell script that looks for some vectors.</p>
<p><img loading="lazy" src="https://i.imgur.com/q5dzts3.png" alt=""  />
</p>
<p>The command is downloading the (win-priv-check.ps1) from my attacker ip address using using the Invoke-WebRequest cmdlet and saving it locally as win.ps1. Running the script it identifies apache is running as admin.</p>
<p><img loading="lazy" src="https://i.imgur.com/OifDB01.png" alt=""  />
</p>
<p>Let&rsquo;s check evader&rsquo;s privileges and check if we can abuse any privileges.</p>
<p><img loading="lazy" src="https://i.imgur.com/a72wbxc.png" alt=""  />
</p>
<p>so we don&rsquo;t have any specific privilege that we can abuse so my next step was to upload a malicious php script to the webserver using pownyshell.</p>
<p>checking the privileges we see it&rsquo;s different from the output we go previously.</p>
<p><img loading="lazy" src="https://i.imgur.com/A9Yszsw.png" alt=""  />
</p>
<p>As we can see we can abuse the <em>&ldquo;SetImpersonatePrivilege&rdquo;</em> any process holding this privilege can impersonate (but not create) any token for which it is able to gethandle. You can get a privileged token from a Windows service (DCOM) making it perform an NTLM authentication against the exploit, then execute a process as SYSTEM <a href="https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/privilege-escalation-abusing-tokens">referenced from here.</a></p>
<p>So our privesc vector are all relate to a potato exploit and after trying and failing i landed on the <em>&ldquo;efspotato&rdquo;</em> exploit which worked and elevate our privileges to NT SYSTEM!!</p>
<p><img loading="lazy" src="https://i.imgur.com/F5WGaj8.png" alt=""  />
</p>
<p>Trying to get the admin flag we are face with some errors.</p>
<p><img loading="lazy" src="https://i.imgur.com/wDnF2Xy.png" alt=""  />
</p>
<p>So the next step was creating a user with admin privileges then rdp into the machine and get the machine.</p>
<p><img loading="lazy" src="https://i.imgur.com/U29uu8P.png" alt=""  />
</p>
<p>Login into the machine with the created user and get the flag</p>
<p><img loading="lazy" src="https://i.imgur.com/jlALEK2.png" alt=""  />
</p>
<p>Hope you learnt something new ‚ú®</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://malw0re.github.io/tags/tryhackme/">tryhackme</a></li>
    </ul>
<nav class="paginav">
  <a class="next" href="https://malw0re.github.io/posts/hacktheboo2023-ctf/forensics/">
    <span class="title">Next ¬ª</span>
    <br>
    <span>Hacktheboo 2023 CTF</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://malw0re.github.io/">OUHBOY</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
