<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>INSECURE RDP | OUHBOY</title>
<meta name="keywords" content="rdp">
<meta name="description" content="Exploiting insecure RDP Services">
<meta name="author" content="Malw0re">
<link rel="canonical" href="https://malw0re.github.io/posts/exploiting-services-series/insecure-rdp/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css" integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U&#43;6hYRq/Ez/nm5vg=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://malw0re.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://malw0re.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://malw0re.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://malw0re.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://malw0re.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="INSECURE RDP" />
<meta property="og:description" content="Exploiting insecure RDP Services" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://malw0re.github.io/posts/exploiting-services-series/insecure-rdp/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-13T17:21:14+03:00" />
<meta property="article:modified_time" content="2023-10-13T17:21:14+03:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="INSECURE RDP"/>
<meta name="twitter:description" content="Exploiting insecure RDP Services"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://malw0re.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "INSECURE RDP",
      "item": "https://malw0re.github.io/posts/exploiting-services-series/insecure-rdp/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "INSECURE RDP",
  "name": "INSECURE RDP",
  "description": "Exploiting insecure RDP Services",
  "keywords": [
    "rdp"
  ],
  "articleBody": "Objective:¬†Exploit the application and retrieve the flag!\nEnumeration Running nmap on our target, we see there‚Äôs a distinct port 3333 with a very peculiar service dec-notes. Our focus primarily will be exploiting the insecure rdp service.\nMetasploit To confirm if the target is running rdp we‚Äôll use a metasploit module called rdp-scanner what it does is it attempts to connect to the specified RDP port and determines if it ‚Äúspeaks‚Äù RDP.\nSetting up the required variables for the module, we get an interesting response it‚Äôs running RDP!!\nBruteforcing credentials But for us to get the flag we need credentials that we can login in using rdp to get the flag, for that we‚Äôll need to bruteforce some credentials.\nWe‚Äôll need to use hydra for this bruteforce.\nhydra -L /usr/share/metasploit-framework/data/wordlists/common_users.txt -P /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt rdp://10.6.23.164:3333 So basically the commands takes in a user and a password wordlist to bruteforce against the rdp service with the specified port number during enumeration.\nAs we can see immediately we get some credentials that we can try logging in with, the account administrator seems perfect cause it has more privileges as compared to the rest so we‚Äôll login with that one to get the flag.\nN|B during an engagement it‚Äôs necessary to check or limit the bruteforce speed as not to cause a denial of service on the service you are pentesting.\nRDP login Having enumerated some credentials, we can login via rdp using the xfreerdp tool since that‚Äôs what is installed in this instance i have, but there are many tools out there that you can use to login via rdp.\nMoving forward we‚Äôll login via xfreerdp.\nWe see we have a GUI instance of RDP connection on the target machine, now we can fetch the flag from the C:/ drive.\nMitigation Against Bruteforce The Bruteforce attack that we just performed can be mitigated. It requires the creation of an Account Policy that will prevent Hydra or any other tool from trying multiple credentials. It is essentially a Lockout Policy. To toggle this policy, we need to open the Local Security Policy window. This can be done by typing ‚Äúsecpol.msc‚Äù.\nChecking out the Account policy we can see there no policies implemented which falls under misconfigurations which lead to such exploitations.\nTo get to the particular policy we need to Account Policies under Security Settings. Inside the Account Policies, there exists an Account Lockout Policy. It contains 3 policies each working on an aspect of the Account Lockout.\nThe first one controls the duration of the lockout. This is the time that is required to be passed to log in again after the lockout. Then we have the Lockout Threshold. This controls the number of invalid attempts. Please toggle these as per your requirements. This should prevent the Bruteforce attack.\nAfter trying the Bruteforce attack using Hydra, it can be observed that it is not possible to extract the credentials as before. Although there is still some risk that can be prevented by forcing the users to change the passwords frequently and enforcing good password policies.\nAs we enabled a lockout policy, we will not be able to log in on the machine even with the correct password until the time passed that we toggled in the policy.\n",
  "wordCount" : "543",
  "inLanguage": "en",
  "datePublished": "2023-10-13T17:21:14+03:00",
  "dateModified": "2023-10-13T17:21:14+03:00",
  "author":{
    "@type": "Person",
    "name": "Malw0re"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://malw0re.github.io/posts/exploiting-services-series/insecure-rdp/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "OUHBOY",
    "logo": {
      "@type": "ImageObject",
      "url": "https://malw0re.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://malw0re.github.io/" accesskey="h" title="OUHBOY (Alt + H)">OUHBOY</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://malw0re.github.io/posts/" title="posts">
                    <span>posts</span>
                </a>
            </li>
            <li>
                <a href="https://malw0re.github.io/about/" title="about">
                    <span>about</span>
                </a>
            </li>
            <li>
                <a href="https://malw0re.github.io/tags/" title="tags">
                    <span>tags</span>
                </a>
            </li>
            <li>
                <a href="https://malw0re.github.io/archives/" title="archives">
                    <span>archives</span>
                </a>
            </li>
            <li>
                <a href="https://malw0re.github.io/search/" title="üîç (Alt &#43; /)" accesskey=/>
                    <span>üîç</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      INSECURE RDP
    </h1>
    <div class="post-description">
      Exploiting insecure RDP Services
    </div>
    <div class="post-meta">&lt;span title=&#39;2023-10-13 17:21:14 &#43;0300 EAT&#39;&gt;October 13, 2023&lt;/span&gt;&amp;nbsp;¬∑&amp;nbsp;3 min&amp;nbsp;¬∑&amp;nbsp;Malw0re

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#enumeration" aria-label="Enumeration">Enumeration</a></li>
                <li>
                    <a href="#metasploit" aria-label="Metasploit">Metasploit</a></li>
                <li>
                    <a href="#bruteforcing-credentials" aria-label="Bruteforcing credentials">Bruteforcing credentials</a><ul>
                        
                <li>
                    <a href="#nb" aria-label="N|B"><em>N|B</em></a></li></ul>
                </li>
                <li>
                    <a href="#rdp-login" aria-label="RDP login">RDP login</a></li>
                <li>
                    <a href="#mitigation-against-bruteforce" aria-label="Mitigation Against Bruteforce">Mitigation Against Bruteforce</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p><strong>Objective:</strong>¬†</p>
<p>Exploit the application and retrieve the flag!</p>
<h3 id="enumeration">Enumeration<a hidden class="anchor" aria-hidden="true" href="#enumeration">#</a></h3>
<p>Running nmap on our target, we see there&rsquo;s a distinct port <code>3333</code> with a very peculiar service <code>dec-notes</code>. Our focus primarily will be exploiting the insecure rdp service.</p>
<p><img loading="lazy" src="https://i.imgur.com/I1s9edD.png" alt=""  />
</p>
<h3 id="metasploit">Metasploit<a hidden class="anchor" aria-hidden="true" href="#metasploit">#</a></h3>
<p>To confirm if the target is running rdp we&rsquo;ll use a metasploit module called <code>rdp-scanner</code> what it does is it attempts to connect to the specified RDP port and determines if it <em>&ldquo;speaks&rdquo;</em> RDP.</p>
<p>Setting up the required variables for the module, we get an interesting response it&rsquo;s running RDP!!</p>
<p><img loading="lazy" src="https://i.imgur.com/54Cb8jL.png" alt=""  />
</p>
<h3 id="bruteforcing-credentials">Bruteforcing credentials<a hidden class="anchor" aria-hidden="true" href="#bruteforcing-credentials">#</a></h3>
<p>But for us to get the flag we need credentials that we can login in using rdp to get the flag, for that we&rsquo;ll need to bruteforce some credentials.</p>
<p>We&rsquo;ll need to use hydra for this bruteforce.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>hydra -L /usr/share/metasploit-framework/data/wordlists/common_users.txt -P /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt rdp://10.6.23.164:3333 
</span></span></code></pre></div><p>So basically the commands takes in a user and a password wordlist to bruteforce against the rdp service with the specified port number during enumeration.</p>
<p>As we can see immediately we get some credentials that we can try logging in with, the account administrator seems perfect cause it has more privileges as compared to the rest so we&rsquo;ll login with that one to get the flag.</p>
<p><img loading="lazy" src="https://i.imgur.com/qtz5e8G.png" alt=""  />
</p>
<h4 id="nb"><em>N|B</em><a hidden class="anchor" aria-hidden="true" href="#nb">#</a></h4>
<p>during an engagement it&rsquo;s necessary to check or limit the bruteforce speed as not to cause a denial of service on the service you are pentesting.</p>
<h3 id="rdp-login">RDP login<a hidden class="anchor" aria-hidden="true" href="#rdp-login">#</a></h3>
<p>Having enumerated some credentials, we can login via rdp using the xfreerdp tool since that&rsquo;s what is installed in this instance i have, but there are many tools out there that you can use to login via rdp.</p>
<p>Moving forward we&rsquo;ll login via xfreerdp.</p>
<p><img loading="lazy" src="https://i.imgur.com/Gp5D6kn.png" alt=""  />
</p>
<p><img loading="lazy" src="https://i.imgur.com/LvnIpr5.png" alt=""  />
</p>
<p>We see we have a GUI instance of RDP connection on the target machine, now we can fetch the flag from the C:/ drive.</p>
<p><img loading="lazy" src="https://i.imgur.com/VWadcyX.png" alt=""  />
</p>
<h3 id="mitigation-against-bruteforce">Mitigation Against Bruteforce<a hidden class="anchor" aria-hidden="true" href="#mitigation-against-bruteforce">#</a></h3>
<p>The Bruteforce attack that we just performed can be mitigated. It requires the creation of an Account Policy that will prevent Hydra or any other tool from trying multiple credentials. It is essentially a Lockout Policy. To toggle this policy, we need to open the Local Security Policy window. This can be done by typing <strong>‚Äúsecpol.msc‚Äù</strong>.</p>
<p>Checking out the Account policy we can see there no policies implemented which falls under misconfigurations which lead to such exploitations.</p>
<p><img loading="lazy" src="https://i.imgur.com/8XxUKeD.png" alt=""  />
</p>
<p>To get to the particular policy we need to Account Policies under Security Settings. Inside the Account Policies, there exists an Account Lockout Policy. It contains 3 policies each working on an aspect of the Account Lockout.</p>
<p>The first one controls the duration of the lockout. This is the time that is required to be passed to log in again after the lockout. Then we have the Lockout Threshold. This controls the number of invalid attempts. Please toggle these as per your requirements. This should prevent the Bruteforce attack.</p>
<p><img loading="lazy" src="https://i.imgur.com/vNRevnq.png" alt=""  />
</p>
<p>After trying the Bruteforce attack using Hydra, it can be observed that it is not possible to extract the credentials as before. Although there is still some risk that can be prevented by forcing the users to change the passwords frequently and enforcing good password policies.</p>
<p><img loading="lazy" src="https://i.imgur.com/YwhqTHW.png" alt=""  />
</p>
<p>As we enabled a lockout policy, we will not be able to log in on the machine even with the correct password until the time passed that we toggled in the policy.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://malw0re.github.io/tags/rdp/">rdp</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://malw0re.github.io/posts/hacktheboo2023-ctf/forensics/">
    <span class="title">¬´ Prev</span>
    <br>
    <span>Hacktheboo 2023 CTF</span>
  </a>
  <a class="next" href="https://malw0re.github.io/posts/metasploit-ctf/metasploit-2/">
    <span class="title">Next ¬ª</span>
    <br>
    <span>MSF CTF II</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://malw0re.github.io/">OUHBOY</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
